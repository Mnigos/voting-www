name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

  workflow_dispatch:

  jobs:
    build:
      name: 'Build 🧱'
      runs-on: ubuntu-latest
      strategy:
        fail-fast: false
        matrix:
          pnpm:
            - 4.11.1
          os:
          - ubuntu-latest

      steps:
        - name: Checkout 🛎
          uses: actions/checkout@master

        - name: Setup node env 🏗
          uses: actions/setup-node@v3.1.1
          with:
            node-version: ${{ matrix.node }}

        - name: Install dependencies 👨🏻‍💻
          run: pnpm install

        - name: Build Application 🧱
          run: yarn build

    lint:
      runs-on: ubuntu-latest
      strategy:
        fail-fast: false
        matrix:
          pnpm:
            - 4.11.1
          os:
            - ubuntu-latest

      steps:
       - name: Format 📐
         run: pnpm format

       - name: Lint 🐱
         run: yarn lint:js

    test:
      strategy:
        fail-fast: false
        matrix:
          pnpm:
            - 4.11.1
          os:
            - ubuntu-latest

      steps:
       - name: Run tests 🧪
         run: npm test

       - name: Collect coverage
         uses: codecov/codecov-action@v3
         with:
           token: ${{ secrets.CODECOV_TOKEN }}
